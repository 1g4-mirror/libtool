#! /bin/sh

# helps bootstrapping libtool, when checked out from CVS
# requires at least GNU autoconf 2.56 and GNU automake 1.7

rm -rf `find . \( -name autom4te.cache -o -name libtool \) -print`

: ${ACLOCAL=aclocal}
: ${AUTOMAKE=automake}
: ${AUTOCONF=autoconf}
: ${AUTOHEADER=autoheader}

# Upgrade caveat

cat <<'EOF'
WARNING: If bootstrapping with this script fails, it may be due to an
WARNING: incompatible installed `libtool.m4' being pulled in to
WARNING: `aclocal.m4'.  The best way to work around such a problem is to
WARNING: uninstall your system libtool files, or failing that, overwrite
WARNING: them with `libtool.m4' as shipped with this distribution.
WARNING: After that, retry this bootstrap.
EOF

# fake the libtool scripts
touch ltmain.sh
touch libtoolize
(cd libltdl && touch ltmain.sh)

for sub in . libltdl cdemo demo depdemo mdemo mdemo2 pdemo tagdemo f77demo; do
  case $sub in
  .)
    top_srcdir=.
    acfiles="$top_srcdir/libtool.m4"
    AUTOMAKE_FLAGS="--gnu --add-missing --copy"
    ;;
  libltdl)
    top_srcdir=..
    acfiles="$top_srcdir/libtool.m4 $top_srcdir/ltdl.m4"
    AUTOMAKE_FLAGS="--gnits --add-missing --copy"
    ;;
  *)
    top_srcdir=..
    acfiles="$top_srcdir/libtool.m4"
    AUTOMAKE_FLAGS="--gnits --add-missing"
    ;;
  esac

  cd $sub
  rm -f acinclude.m4 aclocal.m4 Makefile configure
  for file in $acfiles; do
    cat $file >> ./acinclude.m4
  done

  $ACLOCAL
  test $sub = libltdl && $AUTOHEADER
  test $sub = f77demo && $AUTOHEADER
  eval $AUTOMAKE $AUTOMAKE_FLAGS
  $AUTOCONF
  cd $top_srcdir
done

rm -f ltmain.sh libtoolize libltdl/ltmain.sh

exit 0
