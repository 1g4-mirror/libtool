#! /bin/sh

# Helps bootstrapping libtool, when checked out from CVS
# requires at least GNU autoconf 2.58 and GNU automake 1.8.

# Upgrade caveat.

cat <<'EOF'
WARNING: If bootstrapping with this script fails, it may be due to an
WARNING: incompatible installed `libtool.m4' being pulled in to
WARNING: `aclocal.m4'.  The best way to work around such a problem is to
WARNING: uninstall your system libtool files, or failing that, overwrite
WARNING: them with `libtool.m4' as shipped with this distribution.
WARNING: After that, retry this bootstrap.
EOF

rm -rf `find . \( -name autom4te.cache -o -name libtool \) -print`

fakes="config/ltmain.sh config/libtoolize libltdl/ltmain.sh"

for file in $fakes; do
  cat > $file <<'EOF'
#! /bin/sh
# This is a dummy file for bootstrapping CVS libtool.
echo "$0: Bootstrap detected, no files installed." | sed 's,^.*/,,g'
exit 0
EOF
  chmod 755 $file
done

# Running the installed `libtoolize' will trash the local (newer) libtool.m4
# among others.  Call the dummy script we made earlier.
LIBTOOLIZE=`pwd`/config/libtoolize
export LIBTOOLIZE

for sub in . tests/*demo tests/*demo[1-9]; do
  autoreconf --force --verbose --install $sub
done

for file in $fakes; do
  rm -f $file
done

# These files con cause an infinite configure loop if left behind.
rm -f Makefile libltdl/Makefile libtool

exit 0
